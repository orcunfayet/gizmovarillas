name: Generic CI/CD Pipeline for HTML
run-name: ${{ github.actor }} triggered pipeline ðŸš€
on:
  push:
    branches: [ "main", "master" ]
  pull_request:
    branches: [ "main", "master" ]

# Permissions for GitHub Pages
permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  #job1: validate html
  validate-html:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        # Caching dependencies to speed up the workflow
        with:
          python-version: '3.11'
          cache: 'pip' # Uses requirements.txt to cache downloads

      - name: Install dependencies
        run: pip install -r requirements.txt

      - name: Run Validation
        run: html5validator --root .

  #job2: deploy to github pages
  deploy:
    needs: validate-html
    if: github.event_name == 'push' && (github.ref == 'refs/heads/main' || github.ref == 'refs/heads/master')

    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Pages
        uses: actions/configure-pages@v4

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: '.'

      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
      
      #- name: Discord Failure Alert
      #  if: failure() 
      #  uses: rjstone/discord-webhook-notify@v1
      #  with:
      #    severity: error
      #    username: GitHub Actions
      #    color: '#ff0000' 
      #    details: "ðŸš¨ **Deployment Failed!** \n\nThe HTML pipeline crashed. Please check the GitHub logs."
      #    webhookUrl: ${{ secrets.DISCORD_WEBHOOK }}

